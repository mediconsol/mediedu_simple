#!/bin/bash
set -e

echo "=== Railway Deployment Started ==="
echo "RAILS_ENV: $RAILS_ENV"
echo "PORT: $PORT"

# 데이터베이스 설정
if [ -n "$DATABASE_URL" ]; then
  echo "Setting up PostgreSQL database..."
  
  # 간단한 DB 준비
  rails db:prepare || {
    echo "DB prepare failed, trying create and migrate..."
    rails db:create || true
    rails db:migrate || true
  }
  
  # 시드 데이터
  rails db:seed || echo "Seed loading skipped"
else
  echo "Using SQLite database..."
fi

echo "Starting Rails server..."
exec "$@"